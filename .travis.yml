language: generic

install:
  - curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
script:
  - helm lint */.

before_deploy:
  - helm package -d /tmp/dist/packs */.
  - git read-tree $(git rev-parse origin/gh-pages)
  - git checkout-index -af --prefix /tmp/dist/to-be-deployed
  - mv -vn /tmp/dist/packs/* /tmp/dist/to-be-deployed
  - helm repo index /tmp/dist/to-be-deployed
deploy:
  provider: pages
  github-token: $GITHUB_TOKEN

  local-dir: /tmp/dist/to-be-deployed
  keep-history: false
  on:
    branch: master
